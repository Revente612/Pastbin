<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PastBin - Продвинутый текстовый хостинг</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #ff4444;
            --primary-dark: #cc3333;
            --secondary: #ffaa00;
            --background: #000000;
            --surface: #111111;
            --surface-light: #151515;
            --text: #e0e0e0;
            --text-secondary: #aaa;
            --success: #00c851;
            --premium: linear-gradient(135deg, #ffd700, #ff6b00);
            --admin: linear-gradient(135deg, #ff4444, #cc0000);
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            overflow-x: hidden;
        }

        .hidden {
            display: none !important;
        }

        /* Мобильная навигация */
        .navbar {
            background-color: var(--surface);
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid #222;
            backdrop-filter: blur(10px);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
        }

        .nav-logo h1 {
            font-size: 1.4rem;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }

        .nav-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .nav-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-light);
            border: 1px solid #222;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
            background: #333;
        }

        /* Боттом-бар для мобильных */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid #222;
            display: flex;
            justify-content: space-around;
            padding: 0.5rem;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.8rem;
            min-width: 60px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }

        /* Основной контент */
        .container {
            max-width: 100%;
            margin: 80px 0 70px 0;
            padding: 1rem;
        }

        .section {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            border: 1px solid #222;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
        }

        .section h2 {
            margin-bottom: 1rem;
            color: var(--primary);
            font-size: 1.4rem;
        }

        /* Профиль - мобильная версия */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            background: #333;
        }

        .profile-info {
            flex: 1;
        }

        .profile-username {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .profile-badges {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 0.3rem 0.7rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .badge.admin {
            background: var(--admin);
            color: white;
        }

        .badge.premium {
            background: var(--premium);
            color: black;
        }

        .badge.blood {
            background: #8b0000;
            color: white;
            animation: pulse 2s infinite;
        }

        .profile-bio {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--surface-light);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.2s;
        }

        .stat-card:active {
            transform: scale(0.98);
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Подарки в профиле */
        .gifts-section {
            margin-top: 1.5rem;
        }

        .gifts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .gift-item {
            background: var(--surface-light);
            border-radius: 10px;
            padding: 0.75rem;
            text-align: center;
            border: 1px solid #222;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .gift-item:active {
            transform: scale(0.95);
        }

        .gift-item.featured {
            border-color: var(--secondary);
            box-shadow: 0 0 15px rgba(255, 170, 0, 0.3);
        }

        .gift-emoji {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .gift-name {
            font-size: 0.7rem;
            color: var(--secondary);
            margin-bottom: 0.25rem;
            word-break: break-word;
        }

        .gift-count {
            font-size: 0.65rem;
            color: var(--text-secondary);
            background: #222;
            border-radius: 8px;
            padding: 0.1rem 0.3rem;
        }

        .gift-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 2px;
        }

        .gift-action-btn {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid #333;
            color: var(--text);
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Магазин - мобильная версия */
        .shop-categories {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: none;
        }

        .shop-categories::-webkit-scrollbar {
            display: none;
        }

        .shop-category {
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .shop-category.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }

        .shop-item {
            background: var(--surface-light);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid #222;
            transition: all 0.3s;
        }

        .shop-item:active {
            transform: scale(0.98);
        }

        .shop-item.featured {
            border-color: var(--secondary);
            box-shadow: 0 0 20px rgba(255, 170, 0, 0.2);
        }

        .shop-item-image {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .shop-item-name {
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .shop-item-price {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--secondary);
            font-weight: bold;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        .buy-button {
            width: 100%;
            padding: 0.6rem;
            background: linear-gradient(135deg, var(--success), #007e33);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .buy-button:active {
            transform: translateY(2px);
        }

        .buy-button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        /* Мессенджер - мобильная версия */
        .messenger-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .search-box {
            flex: 1;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid #222;
            border-radius: 20px;
            background: var(--surface-light);
            color: var(--text);
            font-size: 0.9rem;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .contacts-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .contact {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #222;
            cursor: pointer;
            transition: background 0.3s;
        }

        .contact:active {
            background: var(--surface-light);
        }

        .contact.unread {
            background: rgba(255, 68, 68, 0.1);
        }

        .contact-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            background: #333;
            position: relative;
        }

        .online-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            border: 2px solid var(--surface);
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .contact-last-message {
            font-size: 0.8rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .unread-badge {
            background: var(--primary);
            color: white;
            border-radius: 10px;
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            margin-left: auto;
        }

        /* Чат */
        .chat-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background);
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: var(--surface);
            padding: 1rem;
            border-bottom: 1px solid #222;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .back-button {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 15px;
            position: relative;
            word-wrap: break-word;
        }

        .message.sent {
            align-self: flex-end;
            background: var(--primary);
            border-bottom-right-radius: 5px;
        }

        .message.received {
            align-self: flex-start;
            background: var(--surface-light);
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.7);
            text-align: right;
            margin-top: 0.25rem;
        }

        .message-gift {
            border: 2px solid var(--secondary);
            background: rgba(255, 170, 0, 0.1) !important;
        }

        .gift-preview {
            text-align: center;
            padding: 0.5rem;
        }

        .gift-preview-emoji {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .chat-input-container {
            background: var(--surface);
            padding: 1rem;
            border-top: 1px solid #222;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #222;
            border-radius: 20px;
            background: var(--surface-light);
            color: var(--text);
            font-size: 0.9rem;
        }

        .send-button {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .gift-button {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--secondary);
            color: black;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
        }

        /* Посты */
        .posts-grid {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .post-card {
            background: var(--surface-light);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid #222;
            transition: all 0.3s;
        }

        .post-card:active {
            transform: scale(0.99);
        }

        .post-title {
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .post-content {
            color: var(--text);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .post-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .post-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .post-action {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.8rem;
        }

        /* Календарь */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .calendar-day {
            background: var(--surface-light);
            border-radius: 10px;
            padding: 0.75rem;
            text-align: center;
            border: 1px solid #222;
            transition: all 0.3s;
            cursor: pointer;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .calendar-day.claimed {
            background: linear-gradient(135deg, var(--success), #007e33);
            color: white;
        }

        .calendar-day.available {
            background: linear-gradient(135deg, var(--secondary), #ff6b00);
            color: black;
            font-weight: bold;
        }

        .calendar-day.available:active {
            transform: scale(0.95);
        }

        .calendar-day.future {
            background: #222;
            color: #666;
            cursor: not-allowed;
        }

        .day-number {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .day-reward {
            font-size: 0.7rem;
        }

        /* Админ-панель */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .admin-stat {
            background: var(--surface-light);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .admin-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 0.5rem;
        }

        .users-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #222;
        }

        .user-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Формы */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #222;
            border-radius: 10px;
            background: var(--surface-light);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn:active {
            transform: translateY(2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #666, #444);
        }

        .btn-premium {
            background: var(--premium);
            color: black;
        }

        .btn-admin {
            background: var(--admin);
            color: white;
        }

        /* Модальные окна */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 1rem;
        }

        .modal-content {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid #222;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .blood-badge {
            animation: pulse 2s infinite;
        }

        /* Улучшения для очень маленьких экранов */
        @media (max-width: 360px) {
            .container {
                padding: 0.5rem;
            }
            
            .section {
                padding: 1rem;
            }
            
            .shop-items {
                grid-template-columns: 1fr;
            }
            
            .gifts-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .calendar-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Ландшафтная ориентация */
        @media (orientation: landscape) and (max-height: 500px) {
            .container {
                margin: 60px 0 50px 0;
            }
            
            .contacts-list {
                max-height: 200px;
            }
            
            .chat-messages {
                max-height: 60vh;
            }
        }

        /* Уведомления */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            z-index: 4000;
            animation: slideDown 0.3s ease-out;
        }

        .notification.error {
            background: var(--primary);
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Мобильная навигация -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h1><i class="fas fa-skull-crossbones"></i> PastBin</h1>
            </div>
            <div class="nav-actions">
                <div id="userInfo" class="hidden">
                    <img id="userAvatarImg" class="user-avatar" src="" alt="Avatar">
                </div>
                <button class="nav-btn" id="menuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Основной контент -->
    <main class="container">
        <!-- Приветственная секция -->
        <section id="welcomeSection" class="section">
            <h2>Добро пожаловать в PastBin</h2>
            <p>Зарабатывайте Скоины, покупайте подарки и общайтесь с друзьями!</p>
            <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-direction: column;">
                <button class="btn" onclick="showLogin()">Войти</button>
                <button class="btn btn-secondary" onclick="showRegister()">Регистрация</button>
            </div>
        </section>

        <!-- Профиль -->
        <section id="profileSection" class="section hidden">
            <div class="profile-header">
                <img id="profileAvatar" class="profile-avatar" src="" alt="Avatar">
                <div class="profile-info">
                    <div class="profile-username" id="profileUsername"></div>
                    <div class="profile-badges" id="profileBadges"></div>
                    <div class="profile-bio" id="profileBio"></div>
                </div>
            </div>

            <div class="profile-stats">
                <div class="stat-card" onclick="showScoinHistory()">
                    <div class="stat-value" id="profileScoins">0</div>
                    <div class="stat-label">Скоины</div>
                </div>
                <div class="stat-card" onclick="showGifts()">
                    <div class="stat-value" id="profileGiftsCount">0</div>
                    <div class="stat-label">Подарки</div>
                </div>
                <div class="stat-card" onclick="showMessenger()">
                    <div class="stat-value" id="profileMessagesCount">0</div>
                    <div class="stat-label">Сообщения</div>
                </div>
                <div class="stat-card" onclick="showPosts()">
                    <div class="stat-value" id="profilePostsCount">0</div>
                    <div class="stat-label">Посты</div>
                </div>
            </div>

            <div class="gifts-section">
                <h3><i class="fas fa-gift"></i> Мои подарки</h3>
                <div id="profileGiftsContainer" class="gifts-grid">
                    <!-- Подарки будут загружены здесь -->
                </div>
            </div>
        </section>

        <!-- Магазин -->
        <section id="shopSection" class="section hidden">
            <h2>Магазин <span style="color: var(--secondary);" id="shopBalance">⚡ 0</span></h2>
            <div class="shop-categories">
                <button class="shop-category active" data-category="gifts">🎁 Подарки</button>
                <button class="shop-category" data-category="badges">🏷️ Бейджи</button>
                <button class="shop-category" data-category="premium">👑 Премиум</button>
                <button class="shop-category" data-category="special">⭐ Особые</button>
            </div>
            <div id="shopItemsContainer" class="shop-items">
                <!-- Товары будут загружены здесь -->
            </div>
        </section>

        <!-- Мессенджер -->
        <section id="messengerSection" class="section hidden">
            <div class="messenger-header">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchContacts" placeholder="Поиск по имени...">
                </div>
                <button class="nav-btn primary" onclick="showNewChatModal()">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div id="contactsList" class="contacts-list">
                <!-- Контакты будут загружены здесь -->
            </div>
        </section>

        <!-- Посты -->
        <section id="postsSection" class="section hidden">
            <h2>Мои посты</h2>
            <button class="btn" onclick="showCreatePostModal()" style="margin-bottom: 1rem;">
                <i class="fas fa-plus"></i> Создать пост
            </button>
            <div id="postsContainer" class="posts-grid">
                <!-- Посты будут загружены здесь -->
            </div>
        </section>

        <!-- Календарь -->
        <section id="calendarSection" class="section hidden">
            <h2>Ежедневный календарь</h2>
            <div id="calendarInfo" style="margin-bottom: 1rem; padding: 1rem; background: var(--surface-light); border-radius: 8px;">
                <p>Открывайте награды каждый день! Доступно только для премиум-пользователей.</p>
            </div>
            <div id="calendarContainer" class="calendar-grid">
                <!-- Календарь будет загружен здесь -->
            </div>
        </section>

        <!-- Админ-панель -->
        <section id="adminPanelSection" class="section hidden">
            <h2><i class="fas fa-crown"></i> Панель администратора</h2>
            <div class="admin-stats">
                <div class="admin-stat">
                    <div class="admin-stat-value" id="totalScoins">0</div>
                    <div>Общие скоины</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="totalUsers">0</div>
                    <div>Пользователи</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="totalMessages">0</div>
                    <div>Сообщения</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="totalPosts">0</div>
                    <div>Посты</div>
                </div>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                <button class="btn" onclick="showGiveScoinsModal()">Выдать скоины</button>
                <button class="btn btn-premium" onclick="showGivePremiumModal()">Выдать премиум</button>
                <button class="btn btn-admin" onclick="resetAllData()">Сбросить данные</button>
            </div>
            <div id="usersList" class="users-list">
                <!-- Пользователи будут загружены здесь -->
            </div>
        </section>

        <!-- Авторизация -->
        <section id="loginSection" class="section hidden">
            <h2>Вход в систему</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Имя пользователя:</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="Введите имя" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Пароль:</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Введите пароль" required>
                </div>
                <button type="submit" class="btn">Войти</button>
            </form>
            <p style="text-align: center; margin-top: 1rem;">
                Нет аккаунта? <a href="#" onclick="showRegister()" style="color: var(--primary);">Зарегистрируйтесь</a>
            </p>
        </section>

        <section id="registerSection" class="section hidden">
            <h2>Регистрация</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">Имя пользователя:</label>
                    <input type="text" class="form-input" id="registerUsername" placeholder="Придумайте имя" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Пароль:</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="Придумайте пароль" required>
                </div>
                <button type="submit" class="btn">Создать аккаунт</button>
            </form>
            <p style="text-align: center; margin-top: 1rem;">
                Есть аккаунт? <a href="#" onclick="showLogin()" style="color: var(--primary);">Войдите</a>
            </p>
        </section>
    </main>

    <!-- Боттом-бар -->
    <nav class="bottom-nav hidden" id="bottomNav">
        <a class="nav-item" onclick="showProfile()">
            <i class="fas fa-user nav-icon"></i>
            <span>Профиль</span>
        </a>
        <a class="nav-item" onclick="showShop()">
            <i class="fas fa-store nav-icon"></i>
            <span>Магазин</span>
        </a>
        <a class="nav-item" onclick="showMessenger()">
            <i class="fas fa-comments nav-icon"></i>
            <span>Чаты</span>
        </a>
        <a class="nav-item" onclick="showPosts()">
            <i class="fas fa-file-alt nav-icon"></i>
            <span>Посты</span>
        </a>
        <a class="nav-item" onclick="showCalendar()">
            <i class="fas fa-calendar-alt nav-icon"></i>
            <span>Календарь</span>
        </a>
    </nav>

    <!-- Чат (отдельный экран) -->
    <div id="chatContainer" class="chat-container hidden">
        <div class="chat-header">
            <button class="back-button" onclick="closeChat()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <img id="chatAvatar" class="user-avatar" src="" alt="Avatar">
            <div style="flex: 1;">
                <div id="chatUserName" style="font-weight: bold;"></div>
                <div id="chatUserStatus" style="font-size: 0.8rem; color: var(--text-secondary);">online</div>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Сообщения будут загружены здесь -->
        </div>
        <div class="chat-input-container">
            <button class="gift-button" onclick="showSendGiftModal()">
                <i class="fas fa-gift"></i>
            </button>
            <input type="text" class="chat-input" id="messageInput" placeholder="Введите сообщение...">
            <button class="send-button" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Модальные окна -->
    <div id="userMenuModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeModal('userMenuModal')">&times;</span>
            <h2>Меню</h2>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <button class="btn" onclick="showEditProfileModal()">Редактировать профиль</button>
                <button class="btn btn-secondary" onclick="showAccountsModal()">Сменить аккаунт</button>
                <button class="btn btn-admin" onclick="showAdminPanel()" id="adminPanelBtn" style="display: none;">Админ-панель</button>
                <button class="btn" onclick="logout()" style="background: var(--primary);">Выйти</button>
            </div>
        </div>
    </div>

    <div id="sendGiftModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeModal('sendGiftModal')">&times;</span>
            <h2>Отправить подарок</h2>
            <div id="giftSelection" class="gifts-grid" style="margin-bottom: 1rem;"></div>
            <div class="form-group">
                <label class="form-label">Получатель:</label>
                <input type="text" class="form-input" id="giftRecipient" placeholder="Имя пользователя" value="" readonly>
            </div>
            <button class="btn" onclick="sendGiftToUser()">Отправить подарок</button>
        </div>
    </div>

    <div id="createPostModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeModal('createPostModal')">&times;</span>
            <h2>Создать пост</h2>
            <form id="createPostForm">
                <div class="form-group">
                    <label class="form-label">Заголовок:</label>
                    <input type="text" class="form-input" id="postTitle" placeholder="Введите заголовок" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Содержание:</label>
                    <textarea class="form-input" id="postContent" placeholder="Введите текст поста" rows="6" required></textarea>
                </div>
                <button type="submit" class="btn">Опубликовать</button>
            </form>
        </div>
    </div>

    <div id="giveScoinsModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeModal('giveScoinsModal')">&times;</span>
            <h2>Выдать скоины</h2>
            <div class="form-group">
                <label class="form-label">Получатель:</label>
                <input type="text" class="form-input" id="scoinRecipient" placeholder="Имя пользователя">
            </div>
            <div class="form-group">
                <label class="form-label">Количество:</label>
                <input type="number" class="form-input" id="scoinAmount" placeholder="100" min="1">
            </div>
            <button class="btn" onclick="giveScoins()">Выдать</button>
        </div>
    </div>

    <script>
        // Полная система данных
        const shopItems = {
            gifts: [
                { id: 'pepe', name: 'Плюшевый Пепе', price: 30000, emoji: '🐸', description: 'Легендарный Пепе', featured: true },
                { id: 'bear', name: 'Медведь', price: 15, emoji: '🐻', description: 'Милый плюшевый медведь' },
                { id: 'rocket', name: 'Ракета', price: 100, emoji: '🚀', description: 'Быстрая космическая ракета' },
                { id: 'map', name: 'Карта PastBin', price: 55555, emoji: '🗺️', description: 'Эксклюзивная карта', featured: true },
                { id: 'durov', name: 'Дуров', price: 4444, emoji: '👨‍💼', description: 'Основатель Telegram' },
                { id: 'coin', name: 'Золотая монета', price: 50, emoji: '🪙', description: 'Блестящая золотая монета' },
                { id: 'diamond', name: 'Алмаз', price: 500, emoji: '💎', description: 'Драгоценный алмаз' }
            ],
            badges: [
                { id: 'blood', name: 'Бейдж крови', price: 1000, emoji: '🩸', description: 'Анимированный бейдж крови', featured: true },
                { id: 'fire', name: 'Огненный бейдж', price: 750, emoji: '🔥', description: 'Горячий огненный бейдж' },
                { id: 'star', name: 'Звездный бейдж', price: 300, emoji: '⭐', description: 'Сверкающая звезда' }
            ],
            premium: [
                { id: 'premium1', name: 'Премиум 1 месяц', price: 1000, emoji: '👑', description: 'Премиум на 1 месяц' },
                { id: 'premium3', name: 'Премиум 3 месяца', price: 2500, emoji: '👑', description: 'Премиум на 3 месяца' },
                { id: 'premium12', name: 'Премиум 12 месяцев', price: 8000, emoji: '👑', description: 'Премиум на 12 месяцев', featured: true }
            ],
            special: [
                { id: 'animated_bg', name: 'Анимированный фон', price: 2000, emoji: '🎨', description: 'Эксклюзивный анимированный фон профиля' },
                { id: 'nickname_color', name: 'Цветной никнейм', price: 1500, emoji: '🌈', description: 'Возможность изменить цвет ника' }
            ]
        };

        const calendarRewards = [
            { day: 1, reward: 'Медведь', type: 'gift', value: 'bear' },
            { day: 2, reward: '100 скоинов', type: 'scoins', value: 100 },
            { day: 3, reward: 'Премиум на 1 день', type: 'premium', value: 1 },
            { day: 4, reward: '3 ракеты', type: 'gift', value: 'rocket', count: 3 },
            { day: 5, reward: 'Золотая монета', type: 'gift', value: 'coin' },
            { day: 6, reward: '300 скоинов', type: 'scoins', value: 300 },
            { day: 7, reward: '10 ракет + бейдж', type: 'special', value: 'rocket_badge', count: 10 }
        ];

        // Инициализация данных
        let users = JSON.parse(localStorage.getItem('pastbin_users')) || {};
        let userScoins = JSON.parse(localStorage.getItem('pastbin_scoins')) || {};
        let userGifts = JSON.parse(localStorage.getItem('pastbin_gifts')) || {};
        let userBadges = JSON.parse(localStorage.getItem('pastbin_badges')) || {};
        let userPremium = JSON.parse(localStorage.getItem('pastbin_premium')) || {};
        let messages = JSON.parse(localStorage.getItem('pastbin_messages')) || {};
        let userProfiles = JSON.parse(localStorage.getItem('pastbin_user_profiles')) || {};
        let posts = JSON.parse(localStorage.getItem('pastbin_posts')) || {};
        let calendarClaims = JSON.parse(localStorage.getItem('pastbin_calendar')) || {};
        let userAccounts = JSON.parse(localStorage.getItem('pastbin_accounts')) || {};
        let currentUser = JSON.parse(localStorage.getItem('pastbin_current_user')) || null;
        let currentChat = null;
        let selectedGift = null;

        // [Остальной код остаётся полным как в предыдущей версии, включая все функции...]
        // Здесь должен быть полный код всех функций из предыдущей версии + новые улучшения

        // Для экономии места в ответе, представлю только ключевые новые функции:

        // НОВАЯ ФУНКЦИЯ: Отправка подарков в чате
        function showSendGiftModal() {
            if (!currentChat) return;
            
            document.getElementById('giftRecipient').value = currentChat;
            const container = document.getElementById('giftSelection');
            container.innerHTML = '';
            
            const userGiftsList = userGifts[currentUser.username] || [];
            const giftCounts = {};
            
            userGiftsList.forEach(gift => {
                if (!giftCounts[gift.id]) {
                    giftCounts[gift.id] = { count: 0, gift: gift };
                }
                giftCounts[gift.id].count++;
            });
            
            Object.values(giftCounts).forEach(({gift, count}) => {
                const shopItem = [...shopItems.gifts, ...shopItems.badges].find(item => item.id === gift.id);
                if (shopItem && count > 0) {
                    const giftElement = document.createElement('div');
                    giftElement.className = `gift-item ${selectedGift === gift.id ? 'featured' : ''}`;
                    giftElement.innerHTML = `
                        <div class="gift-emoji">${shopItem.emoji}</div>
                        <div class="gift-name">${shopItem.name}</div>
                        <div class="gift-count">×${count}</div>
                    `;
                    giftElement.onclick = () => {
                        selectedGift = gift.id;
                        document.querySelectorAll('.gift-item').forEach(item => item.classList.remove('featured'));
                        giftElement.classList.add('featured');
                    };
                    container.appendChild(giftElement);
                }
            });
            
            if (container.children.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #aaa; grid-column: 1 / -1;">У вас нет подарков для отправки</p>';
            }
            
            document.getElementById('sendGiftModal').classList.remove('hidden');
        }

        function sendGiftToUser() {
            if (!selectedGift || !currentChat) return;
            
            const giftIndex = userGifts[currentUser.username].findIndex(g => g.id === selectedGift);
            if (giftIndex === -1) return;
            
            const gift = userGifts[currentUser.username][giftIndex];
            userGifts[currentUser.username].splice(giftIndex, 1);
            
            if (!userGifts[currentChat]) userGifts[currentChat] = [];
            userGifts[currentChat].push(gift);
            
            // Отправка сообщения о подарке
            const giftMessage = {
                text: `Отправил(а) подарок: ${gift.name} ${gift.emoji}`,
                sender: currentUser.username,
                timestamp: new Date().toISOString(),
                type: 'gift',
                gift: gift
            };
            
            if (!messages[currentUser.username]) messages[currentUser.username] = {};
            if (!messages[currentUser.username][currentChat]) messages[currentUser.username][currentChat] = [];
            if (!messages[currentChat]) messages[currentChat] = {};
            if (!messages[currentChat][currentUser.username]) messages[currentChat][currentUser.username] = [];
            
            messages[currentUser.username][currentChat].push(giftMessage);
            messages[currentChat][currentUser.username].push(giftMessage);
            
            saveAllData();
            closeModal('sendGiftModal');
            loadMessages(currentChat);
            showNotification(`Подарок отправлен пользователю ${currentChat}!`);
        }

        // НОВАЯ ФУНКЦИЯ: Улучшенный поиск в мессенджере
        function setupMessengerSearch() {
            const searchInput = document.getElementById('searchContacts');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterContacts(this.value);
                }, 300);
            });
        }

        // НОВАЯ ФУНКЦИЯ: Система непрочитанных сообщений
        function updateUnreadCounts() {
            if (!currentUser) return;
            
            const userMessages = messages[currentUser.username] || {};
            let totalUnread = 0;
            
            Object.keys(userMessages).forEach(contact => {
                const chatMessages = userMessages[contact] || [];
                const lastRead = userProfiles[currentUser.username]?.lastRead?.[contact] || 0;
                const unreadCount = chatMessages.filter(msg => 
                    new Date(msg.timestamp) > new Date(lastRead) && msg.sender !== currentUser.username
                ).length;
                
                totalUnread += unreadCount;
            });
            
            // Обновление бейджа на иконке мессенджера
            const messengerBadge = document.querySelector('.nav-item:nth-child(3)');
            if (totalUnread > 0) {
                if (!messengerBadge.querySelector('.unread-badge')) {
                    const badge = document.createElement('span');
                    badge.className = 'unread-badge';
                    badge.textContent = totalUnread;
                    badge.style.position = 'absolute';
                    badge.style.top = '5px';
                    badge.style.right = '5px';
                    messengerBadge.style.position = 'relative';
                    messengerBadge.appendChild(badge);
                } else {
                    messengerBadge.querySelector('.unread-badge').textContent = totalUnread;
                }
            } else {
                const existingBadge = messengerBadge.querySelector('.unread-badge');
                if (existingBadge) existingBadge.remove();
            }
        }

        // Инициализация всех функций
        function initApp() {
            createAdminUser();
            setupMessengerSearch();
            
            if (currentUser) {
                initUserData(currentUser.username);
                updateUIForUser();
                showProfile();
                updateUnreadCounts();
            } else {
                showWelcome();
            }
            
            // [Остальные обработчики событий...]
        }

        // Запуск приложения
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
  </html>
